#include <iostream>
#include <cstdio>
#include <cstring>
#include <algorithm>
#include <queue>
#include <vector>
using namespace std;
#define PII pair<int, int>
#define MP(x, y) make_pair(x, y)
#define AA first
#define BB second

const int maxn = 100 + 110 + 2;
const int maxm = 500000;
const int inf = 0x3f3f3f;
int head[maxn], pre[maxn];
int nt[maxm], to[maxm], w[maxm];
int cnt[maxn];
int etot;
int n, m;
int x[maxn], y[maxn], c[maxn];
int s[maxn][maxn];
int dis[maxn];
bool vis[maxn];
vector<PII>e;

void add(int a, int b, int c) {
    to[etot] = b;
    nt[etot] = head[a];
    w[etot] = c;
    head[a] = etot++;
}

int main() {
    while(~scanf("%d%d", &n, &m)) {
        for(int i = 0; i < n + m; i++) {
            scanf("%d%d%d", &x[i], &y[i], &c[i]);
        }
        for(int i = 0; i < n; i++) for(int j = 0; j < m; j++) scanf("%d", &s[i][j]);

        int st = n + m, ed = st + 1;
        etot = 0;
        fill(head, head + ed + 1, -1);
        for(int i = 0; i < n; i++) {
            int tot = 0;
            for(int j = 0; j < m; j++)  tot += s[i][j];
            if(c[i] - tot) add(st, i, 0);
            if(tot)  add(i, st, 0);
            for(int j = 0; j < m; j++) {
                int dis = abs(x[i] - x[j + n]) + abs(y[i] - y[j + n]) + 1;
                add(i, j + n, dis);
                if(s[i][j]) add(j + n, i, -dis);
            }
        }
        for(int j = 0; j < m; j++) {
            int tot = 0;
            for(int i = 0; i < n; i++)  {
                tot += s[i][j];
            }
            if(tot < c[j + n]) add(j + n, ed, 0);
            if(tot) add(ed, j + n, 0);
        }
        fill(cnt, cnt + ed + 2, 0);
        fill(vis, vis + ed + 2, 0);
        fill(dis, dis + ed + 2, inf);
        fill(cir, cir + ed + 2, 0);
        queue<int>q;
        q.push(ed);
        dis[ed] = 0;
        int op = -1;
        while(q.size()) {
            int x = q.front(); q.pop();
            cnt[x]++;
            vis[x] = false;
            bool flg = false;
            if(cnt[x] > ed) { op = x; break; }
            for(int k = head[x]; k != -1; k = nt[k]) {
                int v = to[k];
                if(w[k] + dis[x] < dis[v]) {
                    pre[v] = x;
                    dis[v] = w[k] + dis[x];
                    if(!vis[v]) {
                        q.push(v);
                        vis[v] = true;
                    }
                }
            }
        }
        if(q.size()) {
           puts("SUBOPTIMAL");
           fill(vis, vis + ed + 1, 0);
           do {
               vis[op] = true;
               op = pre[op];
           }while(!vis[op]);

           int rt = op;
           do {
               vis[op] = true;
               int v = op, u = pre[op];
               if(u != st && u != ed && v != st && v != ed)  {
                   if(u < v) s[u][v - n]++;
                   else s[v][u - n]--;
               }
               op = pre[op];
           } while(op != rt);
           for(int i = 0; i < n; i++) {
               printf("%d", s[i][0]);
               for(int j = 1; j < m; j++) printf(" %d", s[i][j]);
               printf("\n");
           }

        }
        else puts("OPTIMAL");
    }
    return 0;
}
